<section class="grid lg:grid-cols-3 gap-8">
  <div class="lg:col-span-2 space-y-4">
    <div class="flex items-end gap-4">
      <div class="flex-1 rounded-xl border border-indigo-100/70 dark:border-gray-800 bg-white/80 dark:bg-gray-900/60 p-4 shadow-soft">
        <div class="text-sm text-gray-500 dark:text-gray-400">Total Entries</div>
        <div class="text-2xl font-semibold"><%= workouts.length %></div>
      </div>
      <div class="flex-1 rounded-xl border border-indigo-100/70 dark:border-gray-800 bg-white/80 dark:bg-gray-900/60 p-4 shadow-soft">
        <div class="text-sm text-gray-500 dark:text-gray-400">Total Minutes</div>
        <div class="text-2xl font-semibold"><%= workouts.reduce((s,w)=>s+w.duration,0) %></div>
      </div>
      <div class="hidden md:block flex-1 rounded-xl border border-indigo-100/70 dark:border-gray-800 bg-white/80 dark:bg-gray-900/60 p-4 shadow-soft">
        <div class="text-sm text-gray-500 dark:text-gray-400">Last Workout</div>
        <div class="text-2xl font-semibold">
          <%= workouts[0] ? new Date(workouts[0].date).toISOString().slice(0,10) : '—' %>
        </div>
      </div>
    </div>

    <div class="rounded-2xl border border-indigo-100/70 dark:border-gray-800 bg-white/80 dark:bg-gray-900/60 overflow-hidden shadow-soft">
      <div class="px-4 py-3 border-b border-indigo-100/60 dark:border-gray-800 flex items-center justify-between">
        <h2 class="text-lg font-semibold">Workouts</h2>
        <a href="/workouts/new" class="text-sm px-3 py-1.5 rounded bg-brand-600 text-white hover:bg-brand-700">Add</a>
      </div>
      <div class="overflow-x-auto">
        <table class="min-w-full text-sm">
          <thead class="bg-indigo-50/60 dark:bg-gray-800/60 text-gray-700 dark:text-gray-300">
            <tr>
              <th class="text-left px-4 py-2">Date</th>
              <th class="text-left px-4 py-2">Type</th>
              <th class="text-left px-4 py-2">Duration</th>
              <th class="px-4 py-2"></th>
            </tr>
          </thead>
          <tbody class="divide-y divide-indigo-100/70 dark:divide-gray-800">
            <% if (workouts.length === 0) { %>
              <tr><td colspan="4" class="px-4 py-6 text-gray-500 text-center">No workouts yet. Add one!</td></tr>
            <% } %>
            <% workouts.forEach(w => { %>
              <tr class="hover:bg-indigo-50/40 dark:hover:bg-gray-800/40">
                <td class="px-4 py-3 font-medium"><%= new Date(w.date).toISOString().slice(0,10) %></td>
                <td class="px-4 py-3">
                  <span class="inline-flex items-center gap-1 px-2 py-1 rounded-full text-xs bg-brand-50 text-brand-700 dark:bg-brand-700/20 dark:text-brand-200">
                    <span class="text-brand-500">•</span><%= w.type %>
                  </span>
                </td>
                <td class="px-4 py-3"><span class="font-semibold"><%= w.duration %></span> min</td>
                <td class="px-4 py-3 text-right space-x-2">
                  <a href="/workouts/<%= w.id %>/edit" class="text-brand-700 hover:underline dark:text-brand-300">Edit</a>
                  <form method="post" action="/workouts/<%= w.id %>/delete" class="inline" onsubmit="return confirm('Delete this workout?');">
                    <button class="text-red-600 hover:underline">Delete</button>
                  </form>
                </td>
              </tr>
            <% }) %>
          </tbody>
        </table>
      </div>
    </div>
  </div>

  <div class="space-y-4">
    <form method="get" action="/" class="rounded-2xl border border-indigo-100/70 dark:border-gray-800 bg-white/80 dark:bg-gray-900/60 p-4 shadow-soft grid md:grid-cols-5 gap-3 items-end">
      <div>
        <label class="block text-xs text-gray-500">From</label>
        <input type="date" name="from" value="<%= filters?.from || '' %>" class="mt-1 w-full border border-gray-200 dark:border-gray-700 bg-white/80 dark:bg-gray-900/50 rounded-lg px-3 py-2" />
      </div>
      <div>
        <label class="block text-xs text-gray-500">To</label>
        <input type="date" name="to" value="<%= filters?.to || '' %>" class="mt-1 w-full border border-gray-200 dark:border-gray-700 bg-white/80 dark:bg-gray-900/50 rounded-lg px-3 py-2" />
      </div>
      <div>
        <label class="block text-xs text-gray-500">Type</label>
        <input type="text" name="type" placeholder="Run, Yoga..." value="<%= filters?.type || '' %>" class="mt-1 w-full border border-gray-200 dark:border-gray-700 bg-white/80 dark:bg-gray-900/50 rounded-lg px-3 py-2" />
      </div>
      <div>
        <label class="block text-xs text-gray-500">Search</label>
        <input type="text" name="q" placeholder="in type or notes" value="<%= filters?.q || '' %>" class="mt-1 w-full border border-gray-200 dark:border-gray-700 bg-white/80 dark:bg-gray-900/50 rounded-lg px-3 py-2" />
      </div>
      <div class="flex gap-2 md:justify-end">
        <button class="px-4 py-2 rounded-lg bg-brand-600 text-white hover:bg-brand-700">Filter</button>
        <a href="/export" class="px-4 py-2 rounded-lg border border-gray-200 dark:border-gray-700 hover:bg-gray-50 dark:hover:bg-gray-800">Export CSV</a>
      </div>
    </form>
    <div class="rounded-2xl border border-indigo-100/70 dark:border-gray-800 bg-white/80 dark:bg-gray-900/60 p-4 shadow-soft">
      <div class="flex items-center justify-between mb-2">
        <h2 class="text-lg font-semibold">Activity (Minutes)</h2>
      </div>
      <canvas id="minutesChart" height="200"></canvas>
    </div>
    <div class="rounded-2xl border border-indigo-100/70 dark:border-gray-800 bg-white/80 dark:bg-gray-900/60 p-5 shadow-soft">
      <div class="flex items-center justify-between">
        <div>
          <div class="text-sm text-gray-500 dark:text-gray-400">Weekly Goal</div>
          <div class="text-2xl font-semibold"><%= weekly.weeklyMinutes %> / <%= weekly.weeklyGoal %> min</div>
        </div>
        <div class="w-48">
          <div class="h-2 w-full bg-gray-200 dark:bg-gray-800 rounded-full overflow-hidden">
            <div class="h-2 bg-brand-600" style="width:<%= weekly.weeklyProgress %>%"></div>
          </div>
          <div class="mt-1 text-right text-xs text-gray-500"><%= weekly.weeklyProgress %>%</div>
        </div>
      </div>
    </div>
    <div class="rounded-2xl border border-indigo-100/70 dark:border-gray-800 bg-gradient-to-br from-brand-600 to-indigo-600 text-white p-5 shadow-soft">
      <div class="text-sm opacity-90">Tip</div>
      <div class="text-lg font-semibold">Small steps add up. Keep your streak going!</div>
    </div>
  </div>
</section>

<script>
  const labels = <%- JSON.stringify(chart.labels) %>;
  const data = <%- JSON.stringify(chart.data) %>;
  const ctx = document.getElementById('minutesChart').getContext('2d');
  const isDark = document.documentElement.classList.contains('dark');
  const gridColor = isDark ? 'rgba(148,163,184,0.2)' : 'rgba(148,163,184,0.35)';
  const tickColor = isDark ? '#cbd5e1' : '#334155';
  const border = 'rgb(99, 102, 241)';
  const bg = 'rgba(99, 102, 241, 0.18)';
  new Chart(ctx, {
    type: 'line',
    data: {
      labels,
      datasets: [{
        label: 'Minutes',
        data,
        borderColor: border,
        backgroundColor: bg,
        tension: 0.35,
        fill: true,
        pointRadius: 3,
        pointHoverRadius: 5
      }]
    },
    options: {
      plugins: {
        legend: { display: false },
        tooltip: { mode: 'index', intersect: false }
      },
      interaction: { mode: 'index', intersect: false },
      scales: {
        x: { grid: { color: gridColor }, ticks: { color: tickColor } },
        y: { beginAtZero: true, grid: { color: gridColor }, ticks: { color: tickColor } }
      }
    }
  });
</script>

